/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/threejs-dice@1.1.0/lib/dice.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";import*as CANNON from"cannon";import*as THREE from"three";class DiceManagerClass{constructor(){this.world=null}setWorld(e){this.world=e,this.diceBodyMaterial=new CANNON.Material,this.floorBodyMaterial=new CANNON.Material,this.barrierBodyMaterial=new CANNON.Material,e.addContactMaterial(new CANNON.ContactMaterial(this.floorBodyMaterial,this.diceBodyMaterial,{friction:.01,restitution:.5})),e.addContactMaterial(new CANNON.ContactMaterial(this.barrierBodyMaterial,this.diceBodyMaterial,{friction:0,restitution:1})),e.addContactMaterial(new CANNON.ContactMaterial(this.diceBodyMaterial,this.diceBodyMaterial,{friction:0,restitution:.5}))}prepareValues(e){if(this.throwRunning)throw new Error("Cannot start another throw. Please wait, till the current throw is finished.");for(let t=0;t<e.length;t++)if(e[t].value<1||e[t].dice.values<e[t].value)throw new Error("Cannot throw die to value "+e[t].value+", because it has only "+e[t].dice.values+" sides.");this.throwRunning=!0;for(let t=0;t<e.length;t++)e[t].dice.simulationRunning=!0,e[t].vectors=e[t].dice.getCurrentVectors(),e[t].stableCount=0;let t=()=>{let i=!0;for(let t=0;t<e.length;t++)e[t].dice.isFinished()?e[t].stableCount++:e[t].stableCount=0,e[t].stableCount<50&&(i=!1);if(i){console.log("all stable"),DiceManager.world.removeEventListener("postStep",t);for(let t=0;t<e.length;t++)e[t].dice.shiftUpperValue(e[t].value),e[t].dice.setVectors(e[t].vectors),e[t].dice.simulationRunning=!1;this.throwRunning=!1}else DiceManager.world.step(DiceManager.world.dt)};this.world.addEventListener("postStep",t)}}class DiceObject{constructor(e){e=this.setDefaults(e,{size:100,fontColor:"#000000",backColor:"#ffffff"}),this.object=null,this.size=e.size,this.invertUpside=!1,this.materialOptions={specular:1515554,color:15790320,shininess:40,shading:THREE.FlatShading},this.labelColor=e.fontColor,this.diceColor=e.backColor}setDefaults(e,t){e=e||{};for(let i in t)t.hasOwnProperty(i)&&(i in e||(e[i]=t[i]));return e}emulateThrow(e){let t=0,i=()=>{this.isFinished()?(t++,50===t&&(DiceManager.world.removeEventListener("postStep",i),e(this.getUpsideValue()))):t=0,DiceManager.world.step(DiceManager.world.dt)};DiceManager.world.addEventListener("postStep",i)}isFinished(){let e=this.object.body.angularVelocity,t=this.object.body.velocity;return Math.abs(e.x)<1&&Math.abs(e.y)<1&&Math.abs(e.z)<1&&Math.abs(t.x)<1&&Math.abs(t.y)<1&&Math.abs(t.z)<1}getUpsideValue(){let e,t=new THREE.Vector3(0,this.invertUpside?-1:1),i=2*Math.PI;for(let s=0;s<this.object.geometry.faces.length;++s){let a=this.object.geometry.faces[s];if(0===a.materialIndex)continue;let r=a.normal.clone().applyQuaternion(this.object.body.quaternion).angleTo(t);r<i&&(i=r,e=a)}return e.materialIndex-1}getCurrentVectors(){return{position:this.object.body.position.clone(),quaternion:this.object.body.quaternion.clone(),velocity:this.object.body.velocity.clone(),angularVelocity:this.object.body.angularVelocity.clone()}}setVectors(e){this.object.body.position=e.position,this.object.body.quaternion=e.quaternion,this.object.body.velocity=e.velocity,this.object.body.angularVelocity=e.angularVelocity}shiftUpperValue(e){let t=this.object.geometry.clone(),i=this.getUpsideValue();for(let s=0,a=t.faces.length;s<a;++s){let a=t.faces[s].materialIndex;if(0!==a){for(a+=e-i-1;a>this.values;)a-=this.values;for(;a<1;)a+=this.values;t.faces[s].materialIndex=a+1}}this.object.geometry=t}getChamferGeometry(e,t,i){let s=[],a=[],r=new Array(e.length);for(let t=0;t<e.length;++t)r[t]=[];for(let o=0;o<t.length;++o){let c=t[o],h=c.length-1,n=new THREE.Vector3,l=new Array(h);for(let t=0;t<h;++t){let i=e[c[t]].clone();n.add(i),r[c[t]].push(l[t]=s.push(i)-1)}n.divideScalar(h);for(let e=0;e<h;++e){let t=s[l[e]];t.subVectors(t,n).multiplyScalar(i).addVectors(t,n)}l.push(c[h]),a.push(l)}for(let e=0;e<t.length-1;++e)for(let i=e+1;i<t.length;++i){let s=[],r=-1;for(let a=0;a<t[e].length-1;++a){let o=t[i].indexOf(t[e][a]);o>=0&&o<t[i].length-1&&(r>=0&&a!==r+1?s.unshift([e,a],[i,o]):s.push([e,a],[i,o]),r=a)}4===s.length&&a.push([a[s[0][0]][s[0][1]],a[s[1][0]][s[1][1]],a[s[3][0]][s[3][1]],a[s[2][0]][s[2][1]],-1])}for(let e=0;e<r.length;++e){let i=r[e],s=[i[0]],o=i.length-1;for(;o;){for(let e=t.length;e<a.length;++e){let t=a[e].indexOf(s[s.length-1]);if(t>=0&&t<4){-1==--t&&(t=3);let r=a[e][t];if(i.indexOf(r)>=0){s.push(r);break}}}--o}s.push(-1),a.push(s)}return{vectors:s,faces:a}}makeGeometry(e,t,i,s,a){let r=new THREE.Geometry;for(let t=0;t<e.length;++t){let s=e[t].multiplyScalar(i);s.index=r.vertices.push(s)-1}for(let e=0;e<t.length;++e){let i=t[e],o=i.length-1,c=2*Math.PI/o;for(let e=0;e<o-2;++e)r.faces.push(new THREE.Face3(i[0],i[e+1],i[e+2],[r.vertices[i[0]],r.vertices[i[e+1]],r.vertices[i[e+2]]],0,i[o]+1)),r.faceVertexUvs[0].push([new THREE.Vector2((Math.cos(a)+1+s)/2/(1+s),(Math.sin(a)+1+s)/2/(1+s)),new THREE.Vector2((Math.cos(c*(e+1)+a)+1+s)/2/(1+s),(Math.sin(c*(e+1)+a)+1+s)/2/(1+s)),new THREE.Vector2((Math.cos(c*(e+2)+a)+1+s)/2/(1+s),(Math.sin(c*(e+2)+a)+1+s)/2/(1+s))])}return r.computeFaceNormals(),r.boundingSphere=new THREE.Sphere(new THREE.Vector3,i),r}createShape(e,t,i){let s=new Array(e.length),a=new Array(t.length);for(let t=0;t<e.length;++t){let a=e[t];s[t]=new CANNON.Vec3(a.x*i,a.y*i,a.z*i)}for(let e=0;e<t.length;++e)a[e]=t[e].slice(0,t[e].length-1);return new CANNON.ConvexPolyhedron(s,a)}getGeometry(){let e=this.size*this.scaleFactor,t=new Array(this.vertices.length);for(let e=0;e<this.vertices.length;++e)t[e]=(new THREE.Vector3).fromArray(this.vertices[e]).normalize();let i=this.getChamferGeometry(t,this.faces,this.chamfer),s=this.makeGeometry(i.vectors,i.faces,e,this.tab,this.af);return s.cannon_shape=this.createShape(t,this.faces,e),s}calculateTextureSize(e){return Math.max(128,Math.pow(2,Math.floor(Math.log(e)/Math.log(2))))}createTextTexture(e,t,i){let s=document.createElement("canvas"),a=s.getContext("2d"),r=2*this.calculateTextureSize(this.size/2+this.size*this.textMargin);s.width=s.height=r,a.font=r/(1+2*this.textMargin)+"pt Arial",a.fillStyle=i,a.fillRect(0,0,s.width,s.height),a.textAlign="center",a.textBaseline="middle",a.fillStyle=t,a.fillText(e,s.width/2,s.height/2);let o=new THREE.Texture(s);return o.needsUpdate=!0,o}getMaterials(){let e=[];for(let t=0;t<this.faceTexts.length;++t){let i=null;i=this.customTextTextureFunction?this.customTextTextureFunction(this.faceTexts[t],this.labelColor,this.diceColor):this.createTextTexture(this.faceTexts[t],this.labelColor,this.diceColor),e.push(new THREE.MeshPhongMaterial(Object.assign({},this.materialOptions,{map:i})))}return e}getObject(){return this.object}create(){if(!DiceManager.world)throw new Error("You must call DiceManager.setWorld(world) first.");return this.object=new THREE.Mesh(this.getGeometry(),new THREE.MultiMaterial(this.getMaterials())),this.object.reveiceShadow=!0,this.object.castShadow=!0,this.object.diceObject=this,this.object.body=new CANNON.Body({mass:this.mass,shape:this.object.geometry.cannon_shape,material:DiceManager.diceBodyMaterial}),this.object.body.linearDamping=.1,this.object.body.angularDamping=.1,DiceManager.world.add(this.object.body),this.object}updateMeshFromBody(){this.simulationRunning||(this.object.position.copy(this.object.body.position),this.object.quaternion.copy(this.object.body.quaternion))}updateBodyFromMesh(){this.object.body.position.copy(this.object.position),this.object.body.quaternion.copy(this.object.quaternion)}}export class DiceD4 extends DiceObject{constructor(e){super(e),this.tab=-.1,this.af=7*Math.PI/6,this.chamfer=.96,this.vertices=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],this.faces=[[1,0,2,1],[0,1,3,2],[0,3,2,3],[1,2,3,4]],this.scaleFactor=1.2,this.values=4,this.faceTexts=[[],["0","0","0"],["2","4","3"],["1","3","4"],["2","1","4"],["1","2","3"]],this.customTextTextureFunction=function(e,t,i){let s=document.createElement("canvas"),a=s.getContext("2d"),r=2*this.calculateTextureSize(this.size/2+2*this.size);s.width=s.height=r,a.font=r/5+"pt Arial",a.fillStyle=i,a.fillRect(0,0,s.width,s.height),a.textAlign="center",a.textBaseline="middle",a.fillStyle=t;for(let t in e)a.fillText(e[t],s.width/2,s.height/2-.3*r),a.translate(s.width/2,s.height/2),a.rotate(2*Math.PI/3),a.translate(-s.width/2,-s.height/2);let o=new THREE.Texture(s);return o.needsUpdate=!0,o},this.mass=300,this.inertia=5,this.invertUpside=!0,this.create()}}export class DiceD6 extends DiceObject{constructor(e){super(e),this.tab=.1,this.af=Math.PI/4,this.chamfer=.96,this.vertices=[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]],this.faces=[[0,3,2,1,1],[1,2,6,5,2],[0,1,5,4,3],[3,7,6,2,4],[0,4,7,3,5],[4,5,6,7,6]],this.scaleFactor=.9,this.values=6,this.faceTexts=[" ","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],this.textMargin=1,this.mass=300,this.inertia=13,this.create()}}export class DiceD8 extends DiceObject{constructor(e){super(e),this.tab=0,this.af=-Math.PI/4/2,this.chamfer=.965,this.vertices=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],this.faces=[[0,2,4,1],[0,4,3,2],[0,3,5,3],[0,5,2,4],[1,3,4,5],[1,4,2,6],[1,2,5,7],[1,5,3,8]],this.scaleFactor=1,this.values=8,this.faceTexts=[" ","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],this.textMargin=1.2,this.mass=340,this.inertia=10,this.create()}}export class DiceD10 extends DiceObject{constructor(e){super(e),this.tab=0,this.af=6*Math.PI/5,this.chamfer=.945,this.vertices=[],this.faces=[[5,7,11,0],[4,2,10,1],[1,3,11,2],[0,8,10,3],[7,9,11,4],[8,6,10,5],[9,1,11,6],[2,0,10,7],[3,5,11,8],[6,4,10,9],[1,0,2,-1],[1,2,3,-1],[3,2,4,-1],[3,4,5,-1],[5,4,6,-1],[5,6,7,-1],[7,6,8,-1],[7,8,9,-1],[9,8,0,-1],[9,0,1,-1]];for(let e=0,t=0;e<10;++e,t+=2*Math.PI/10)this.vertices.push([Math.cos(t),Math.sin(t),.105*(e%2?1:-1)]);this.vertices.push([0,0,-1]),this.vertices.push([0,0,1]),this.scaleFactor=.9,this.values=10,this.faceTexts=[" ","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],this.textMargin=1,this.mass=350,this.inertia=9,this.create()}}export class DiceD12 extends DiceObject{constructor(e){super(e);let t=(1+Math.sqrt(5))/2,i=1/t;this.tab=.2,this.af=-Math.PI/4/2,this.chamfer=.968,this.vertices=[[0,i,t],[0,i,-t],[0,-i,t],[0,-i,-t],[t,0,i],[t,0,-i],[-t,0,i],[-t,0,-i],[i,t,0],[i,-t,0],[-i,t,0],[-i,-t,0],[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]],this.faces=[[2,14,4,12,0,1],[15,9,11,19,3,2],[16,10,17,7,6,3],[6,7,19,11,18,4],[6,18,2,0,16,5],[18,11,9,14,2,6],[1,17,10,8,13,7],[1,13,5,15,3,8],[13,8,12,4,5,9],[5,4,14,9,15,10],[0,12,8,10,16,11],[3,19,7,17,1,12]],this.scaleFactor=.9,this.values=12,this.faceTexts=[" ","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],this.textMargin=1,this.mass=350,this.inertia=8,this.create()}}export class DiceD20 extends DiceObject{constructor(e){super(e);let t=(1+Math.sqrt(5))/2;this.tab=-.2,this.af=-Math.PI/4/2,this.chamfer=.955,this.vertices=[[-1,t,0],[1,t,0],[-1,-t,0],[1,-t,0],[0,-1,t],[0,1,t],[0,-1,-t],[0,1,-t],[t,0,-1],[t,0,1],[-t,0,-1],[-t,0,1]],this.faces=[[0,11,5,1],[0,5,1,2],[0,1,7,3],[0,7,10,4],[0,10,11,5],[1,5,9,6],[5,11,4,7],[11,10,2,8],[10,7,6,9],[7,1,8,10],[3,9,4,11],[3,4,2,12],[3,2,6,13],[3,6,8,14],[3,8,9,15],[4,9,5,16],[2,4,11,17],[6,2,10,18],[8,6,7,19],[9,8,1,20]],this.scaleFactor=1,this.values=20,this.faceTexts=[" ","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],this.textMargin=1,this.mass=400,this.inertia=6,this.create()}}export const DiceManager=new DiceManagerClass;"function"==typeof define&&define.amd?define((function(){return{DiceManager:DiceManager,DiceD4:DiceD4,DiceD6:DiceD6,DiceD8:DiceD8,DiceD10:DiceD10,DiceD12:DiceD12,DiceD20:DiceD20}})):"undefined"!=typeof module&&void 0!==module.exports?module.exports={DiceManager:DiceManager,DiceD4:DiceD4,DiceD6:DiceD6,DiceD8:DiceD8,DiceD10:DiceD10,DiceD12:DiceD12,DiceD20:DiceD20}:window.Dice={DiceManager:DiceManager,DiceD4:DiceD4,DiceD6:DiceD6,DiceD8:DiceD8,DiceD10:DiceD10,DiceD12:DiceD12,DiceD20:DiceD20};
//# sourceMappingURL=/sm/3c05e2b70c0a9ffa488fdf531555c6320d423efd9847aeb63d4d2dca3759c238.map